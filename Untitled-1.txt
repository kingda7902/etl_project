function objSearch(){this.DataUnit="";this.DataType="";this.DataTab="";this.OrderBy="";this.OrderType="";this.CityId="";this.CityId2="";this.CityId3="";this.CityName="";this.CityName2="";this.CityName3="";this.AreaId="";this.AreaId2="";this.AreaId3="";this.AreaName="";this.AreaName2="";this.AreaName3="";this.PurposeID="";this.PriceRental="";this.PriceL="";this.PriceH="";this.MRTLine="";this.MRTLine2="";this.MRTLine3="";this.MRTLineName="";this.MRTLineName2="";this.MRTLineName3="";this.MRTStation="";this.MRTStation2="";this.MRTStation3="";this.MRTStationName="";this.MRTStationName2="";this.MRTStationName3="";this.SchoolType="";this.SchoolTypeName="";this.SchoolId="";this.SchoolName="";this.BuildingID="";this.BuildingName="";this.KeyWord="";this.KWkind="";this.KWID="";this.KWCounty="";this.KWDistrict="";this.NotRequiredOtherFeeID="";this.NotRequiredEquipmentID="";this.NotRequiredBaseMent="";this.Room="";this.LevelGroundID="";this.CaseTypeID="";this.AgentPositionID="";this.CaseFromFloor="";this.CaseToFloor="";this.BuildYear="";this.BuildYearL="";this.BuildYearH="";this.chkOTLimSex="";this.OTLimSex="";this.OTParkingSpace="";this.OTLimWithLandlord="";this.OTLimPet="";this.TGType="";this.EquipmentID="";this.PMPage="1";this.BrowseMode="";this.CenterLat="";this.CenterLng="";this.SID="";this.Distance="";this.SearchList="";this.MemberID="";this.MainShopID="";this.AgentName="";this.LandlordNo="";this.Search=function(){var n;$(".ajax-loading",$(".l-content")).show();$("#divInfo").hide();$("#SearchContentDiv").html("");var r=this,u=JSON.parse(JSON.stringify(r)),i="",t=$("#hidjsVID").val();if(t!=""){var f=t.substr(0,2),e=t.substr(1,2),o=t.substr(2,2);i="/ashx/search/search.ashx?VID="+f+e/o}else i="/ashx/search/search.ashx";n=new ETLib.Comm.GatewayJsonClient(i);n.Method="INQUIRE";n.JsonData.RequestJsonInput=u;n.Submit(function(){var i=n.JsonData.ResponseJsonOutput,t,f,e;if(i.Status=="1"){t=i.Data;switch(i.StatusCode){case"1":$("#SearchContentDiv").html(t.SearchContent);t.HouseCount>0?(u.AgentName==""&&$("#agentCaseList").remove(),$("#HouseCount").html(t.HouseCount),$("#PageCount").html(t.PageCount),jQuery(".showleavemsg").CiRoBox({click:!0,BoxWidth:560,BoxHeight:581,GoFunctionStart:[window.parent.CiRoBoxAutoHeight]}),f=$("#hidjsFavPressed").val(),f.length>0&&(e=$("#hidjsypos").val(),e!=""&&window.scrollTo(0,parseInt(e)),saveHouseFavorite(f)),$("#divInfo").show(),$(".l-content .printList").show()):($("#divInfo").hide(),$(".l-content .printList").hide());$(".ajax-loading",$(".l-content")).hide();ViewContent("get","");t.AddDataSourceCache=="1"&&r.AddDataSourceCache()}}else i.Status=="-1"},function(){})};this.SearchMap=function(){this.KeyWord="台北市大安區";var i=JSON.parse(JSON.stringify(this)),t=this,n=new ETLib.Comm.GatewayJsonClient("/Ashx/Map/GetMapPosition.ashx");n.Method="Inquire";n.JsonData.RequestJsonInput=i;n.Submit(function(){var i=n.JsonData.ResponseJsonOutput.Data;t.CenterLat=i.CenterLat;t.CenterLon=i.CenterLng;mapInit(t)},function(){})};this.SearchPrice=function(){var t=this,i=JSON.parse(JSON.stringify(t)),n=new ETLib.Comm.GatewayJsonClient("/ashx/rentprice/list.ashx");n.Method="INQUIRE";n.JsonData.RequestJsonInput=i;n.Submit(function(){var o=n.JsonData.ResponseJsonOutput;if(o.Status=="1"){var i=o.Data,r=JSON.parse(i.Order),u=JSON.parse(r.deal),f=JSON.parse(r.level),e=JSON.parse(r.price),t="";t+='\t<div class="ContHeader both"><h4 class="title">'+i.PlaceList+"周遭租金行情表<\/h4>";t+='\t\t<a href="'+i.PrintUrl+'" class="print" target="_blank"><span>列印<\/span><\/a>';t+="\t<\/div>";t+='\t<div class="tableWrap">';t+='\t\t<div class="DataList titleBar both">';t+='\t\t\t<div class="time"><a href="javascript:;" onclick="ChangeSort(\''+u.order_by+"', '"+u.order_type+'\');">成交時間<span class="arrow '+u.arrow_css+'"><\/span><\/a><\/div>';t+='\t\t\t<div class="use">用途<\/div>';t+='\t\t\t<div class="patterns">型態<\/div>';t+='\t\t\t<div class="road">路段<\/div>';t+='\t\t\t<div class="level"><a href="javascript:;" onclick="ChangeSort(\''+f.order_by+"', '"+f.order_type+'\');">坪數<span class="arrow '+f.arrow_css+'"><\/span><\/a><\/div>';t+='\t\t\t<div class="money"><a href="javascript:;" onclick="ChangeSort(\''+e.order_by+"', '"+e.order_type+'\');">租金<span class="arrow '+e.arrow_css+'"><\/span><\/a><\/div>';t+='\t\t\t<div class="floor">樓層<\/div>';t+="\t\t<\/div>";t+=i.PriceList;t+="\t<\/div>";t+=i.NavPage;t+='<small class="info-small"><em>註：本租金行情頁僅供參考，不作其他用途。<\/em><\/small>';$("#RPtable").html(t)}else $("#RPtable").html('<small class="noData-small"><em>很抱歉！目前沒有符合您查詢的行情喔！<\/em><\/small>')},function(){$("#RPtable").html('<small class="noData-small"><em>很抱歉！目前沒有符合您查詢的行情喔！<\/em><\/small>')})};this.UpdSearchConditionData=function(n){var i=JSON.parse(JSON.stringify(this)),t=new ETLib.Comm.GatewayJsonClient("/ashx/search/NowSearchCondition.ashx");t.Method="UPDATE";t.JsonData.RequestJsonInput=i;t.Submit(function(){var i=t.JsonData.ResponseJsonOutput,r;if(i.Status=="1"){r=i.Data;switch(i.StatusCode){}}else i.Status=="-1";typeof n=="function"&&n()},function(){})};this.AddDataSourceCache=function(){var t=JSON.parse(JSON.stringify(this)),n=new ETLib.Comm.GatewayJsonClient("/ashx/search/AddDataSourceCache.ashx");n.Method="UPDATE";n.JsonData.RequestJsonInput=t;n.Submit(function(){var t=n.JsonData.ResponseJsonOutput,i;if(t.Status=="1"){i=t.Data;switch(t.StatusCode){}}else t.Status=="-1"},function(){})};this.UpdKeyWordData=function(){var t={Keyword:this.KeyWord,id:this.KWID,kind:this.KWkind,AreaData:[{County:this.KWCounty,District:this.KWDistrict}]},n=new ETLib.Comm.GatewayJsonClient("/ashx/search/ListKeyWord.ashx");n.Method="ADD";n.JsonData.RequestJsonInput=t;n.Submit(function(){var t=n.JsonData.ResponseJsonOutput,i;if(t.Status=="1"){i=t.Data;switch(t.StatusCode){}}else t.Status=="-1"},function(){})};this.WebMaxDoRentSearch=function(){var n=[],a,f,e,o,s,t,i,r,u;n.push([1,"1"]);a=this.DataUnit;switch(a){case"1":f="";e="";typeof $(".tabContList.curr .selectFn").eq(0).attr("data-postname")!="undefined"&&(f=$(".tabContList.curr .selectFn").eq(0).attr("data-postname"),n.push([2,f]));typeof $(".tabContList.curr .selectFn").eq(1).attr("data-postname")!="undefined"&&(e=$(".tabContList.curr .selectFn").eq(1).attr("data-postname"),n.push([3,e]));break;case"3":this.CityName!=""&&this.CityName!="undefined"&&n.push([2,this.CityName]);this.AreaName!=""&&this.AreaName!="undefined"&&n.push([3,this.AreaName]);this.SchoolTypeName!=""&&this.SchoolTypeName!="undefined"&&n.push([16,this.SchoolTypeName]);this.SchoolName!=""&&this.SchoolName!="undefined"&&n.push([17,this.SchoolName]);break;case"4":o="";typeof $(".tabContList.curr .selectFn").eq(0).attr("data-postname")!="undefined"&&(o=$(".tabContList.curr .selectFn").eq(0).attr("data-postname"));n.push([9,o]);break;case"5":this.CityName!=""&&this.CityName!="undefined"&&n.push([2,this.CityName]);this.AreaName!=""&&this.AreaName!="undefined"&&n.push([3,this.AreaName])}s="";$.trim(this.PurposeID)!=""&&typeof $(".tabContList.curr .useWrap").eq(0).attr("data-postname")!="undefined"&&(s=$(".tabContList.curr .useWrap").eq(0).attr("data-postname"),n.push([4,s]));var v="~10000,~10000,10000~15000,15000~20000,,25000~,~10000,20000~25000,25000~",h=this.PriceL,c=this.PriceH,l="";this.PriceRental!=""&&this.PriceRental!="undefined"&&(l=this.PriceRental,h=v.split(",")[parseInt(l.substring(2))-1].split("~")[0],c=v.split(",")[parseInt(l.substring(2))-1].split("~")[1]);h!=""&&n.push([6,h]);c!=""&&n.push([7,c]);t="";$('input:checkbox:checked[name="Room"]').each(function(){t+=$(this).next().text()+","});t!=""&&n.push([10,t.substring(0,t.length-1)]);i="";$('input:checkbox:checked[name="CaseTypeID"]').each(function(){i+=$(this).next().text()+","});i!=""&&n.push([13,i.substring(0,i.length-1)]);r="";u="";this.BuildYear!=""?(r="",u="5"):(r=this.BuildYearL,u=this.BuildYearH);r!=""&&n.push([14,r]);u!=""&&n.push([15,u])};this.InitFunction=function(n){return n.Search=this.Search,n.SearchPrice=this.SearchPrice,n.SearchMap=this.SearchMap,n.UpdSearchConditionData=this.UpdSearchConditionData,n.AddDataSourceCache=this.AddDataSourceCache,n.UpdKeyWordData=this.UpdKeyWordData,n.WebMaxDoRentSearch=this.WebMaxDoRentSearch,n}}function PM(n){$("#PMPage").val(n);SetPrintURL();GoSearch(!1,function(){jQuery("html , body").stop().animate({scrollTop:jQuery(".m-nav-ft").offset().top+"px"},500)},!0,2)}function SetPrintURL(){var i=$("#hidSid").val(),t=$("#hidLandlordNo").val(),r=$("#PMPage").val(),n="";t!=""&&nowsearchdata!=null&&(nowsearchdata.TGType!=""&&(n+="&poitypeid="+nowsearchdata.TGType),nowsearchdata.OTLimPet!=""&&(n+="&pet="+nowsearchdata.OTLimPet),nowsearchdata.NotRequiredOtherFeeID!=""&&(n+="&notfeeid="+nowsearchdata.NotRequiredOtherFeeID),nowsearchdata.NotRequiredEquipmentID!=""&&(n+="&noteqid="+nowsearchdata.NotRequiredEquipmentID),nowsearchdata.NotRequiredBaseMent!=""&&(n+="&notbm="+nowsearchdata.NotRequiredBaseMent),nowsearchdata.Room!=""&&(n+="&rm="+nowsearchdata.Room),nowsearchdata.CaseTypeID!=""&&(n+="&ctypeid="+nowsearchdata.CaseTypeID),nowsearchdata.AgentPositionID!=""&&(n+="&agposid="+nowsearchdata.AgentPositionID),nowsearchdata.CaseFromFloor!=""&&(n+="&floor_l="+nowsearchdata.CaseFromFloor),nowsearchdata.CaseToFloor!=""&&(n+="&floor_h="+nowsearchdata.CaseToFloor),nowsearchdata.BuildYearL!=""&&(n+="&budyear_l="+nowsearchdata.BuildYearL),nowsearchdata.BuildYearH!=""&&(n+="&budyear_h="+nowsearchdata.BuildYearH),nowsearchdata.OTLimSex!=""&&(n+="&sex="+nowsearchdata.OTLimSex),nowsearchdata.OTParkingSpace!=""&&(n+="&parkingspc="+nowsearchdata.OTParkingSpace),nowsearchdata.OTLimWithLandlord!=""&&(n+="&livewithll="+nowsearchdata.OTLimWithLandlord),nowsearchdata.EquipmentID!=""&&(n+="&eqid="+nowsearchdata.EquipmentID),nowsearchdata.OrderBy!=""&&(n+="&ord="+nowsearchdata.OrderBy),nowsearchdata.OrderType!=""&&(n+="&ordtype="+nowsearchdata.OrderType),nowsearchdata.LevelGroundID!=""&&(n+="&lvgid="+nowsearchdata.LevelGroundID),nowsearchdata.DataTab!=""&&(n+="&tab="+nowsearchdata.DataTab));$(".l-content .printList a").attr("href","/search/searchprint.aspx?sid="+i+"&no="+t+"&pidx="+r+n)}function ChangeTab(n){$("#DataTab > li").each(function(){$(this).removeClass("curr")});$("#ShowTab"+n).addClass("curr")}function SetSort(n){$("#txtOrderBy").val(n);n=="ByPrice_D"||n=="ByPin_D"||n=="ByHitCount"||n=="ByUpdate"||n=="ByPost"?$("#txtOrderType").val("Desc"):(n=="ByPrice"||n=="ByPin"||n=="ByHitCount")&&$("#txtOrderType").val("Asc");GoSearch(!0,"",!0,2)}function ChangeSort(n,t){$("#txtOrderBy").val(n);$("#txtOrderType").val(t);$("#SelectBy").val(n);GoSearch(!0,"",!0,2)}function ChangeMode(n,t){$("#BrowseMode > li").each(function(){$(this).removeClass("curr")});$("#"+n).addClass("curr");n=="ShowModePics"?($("#divOrder").show(),$("#txtOrderBy").val()!=""&&$("#SelectBy").val($("#txtOrderBy").val())):n=="ShowModeText"&&$("#divOrder").hide();t&&nowsearchdata!=null&&GoSearch(!0,"",!0,2)}function saveHouseFavorite(n){var r=$(window).scrollTop(),i=i=window.location.href;i.indexOf("?")>-1&&(i=window.location.href.substring(0,i.indexOf("?")));var u=i+"?fav="+n+"&pmpage="+$("#PMPage").val()+"&ypos="+r,f={rentid:n,backurl:u},t=new ETLib.Comm.GatewayJsonClient("/Ashx/Search/AddRentFavorite.ashx");t.Method="AddRentFavorite";t.JsonData.RequestJsonInput=f;t.Encoding=1;t.AutoEncodeValue=!0;t.Submit(function(){var i=t.JsonData.ResponseJsonOutput.Data,r=t.JsonData.ResponseJsonOutput.StatusCode;showAddFavoriteCirobox(i,n,r)},function(){})}function showAddFavoriteCirobox(n,t,i){_appendBoxObject="";_appendBoxObject+='<div class="cont-Wrap cont-text-mag">';_appendBoxObject+=n;_appendBoxObject+="<\/div>";_appendBoxObject+='<div class="btn-Wrap">';_appendBoxObject+='<button type="button" class="btn close-btn">確定<\/button>';_appendBoxObject+="<\/div>";jQuery(".box-addfavorite"+t).CiRoBox({iframe:!1,BoxWidth:400,BoxHeight:150});(i=="1"||i=="2")&&(SetBtnViewed("add","favorite"+t),$("#txtfav"+t).html("已收藏"))}function fnMatchMail(){var t=window.location.href,i,n,r;t.indexOf("?")>-1&&(t=window.location.href.substring(0,t.indexOf("?")));i=t+"?match=Y";n=new ETLib.Comm.GatewayJsonClient("/Ashx/Search/AddMatchMail.ashx");n.Method="AddMatchMail";r={backurl:i};n.JsonData.RequestJsonInput=r;n.Encoding=1;n.AutoEncodeValue=!0;n.Submit(function(){var t=n.JsonData.ResponseJsonOutput.Data,i=n.JsonData.ResponseJsonOutput.StatusCode;showAddMatchMail(i,t)},function(){})}function showAddMatchMail(n,t){_appendBoxObject="";_appendBoxObject+='<div class="cont-Wrap cont-text-mag">';_appendBoxObject+=t;_appendBoxObject+="<\/div>";_appendBoxObject+='<div class="btn-Wrap">';_appendBoxObject+='<button type="button" class="btn close-btn">確定<\/button>';_appendBoxObject+="<\/div>";n=="7"||n=="6"?jQuery("#btnMatchMail").CiRoBox({iframe:!1,BoxWidth:350,BoxHeight:200}):jQuery("#btnMatchMail").CiRoBox({iframe:!1,BoxWidth:350,BoxHeight:150})}function fnPairFavorite(){var t=window.location.href,i,n,r;t.indexOf("?")>-1&&(t=window.location.href.substring(0,t.indexOf("?")));i=t+"?pairfav=Y";n=new ETLib.Comm.GatewayJsonClient("/Ashx/Search/AddPairFavorite.ashx");n.Method="AddPairFavorite";r={backurl:i};n.JsonData.RequestJsonInput=r;n.Encoding=1;n.AutoEncodeValue=!0;n.Submit(function(){var t=n.JsonData.ResponseJsonOutput.Data,i=n.JsonData.ResponseJsonOutput.StatusCode;showAddPairFavorite(i,t)},function(){})}function showAddPairFavorite(n,t){_appendBoxObject="";_appendBoxObject+='<div class="cont-Wrap cont-text-mag">';_appendBoxObject+=t;_appendBoxObject+="<\/div>";_appendBoxObject+='<div class="btn-Wrap">';_appendBoxObject+='<button type="button" class="btn close-btn">確定<\/button>';_appendBoxObject+="<\/div>";n=="7"||n=="3"?jQuery("#btnMatchMail").CiRoBox({iframe:!1,BoxWidth:350,BoxHeight:200}):jQuery("#btnMatchMail").CiRoBox({iframe:!1,BoxWidth:350,BoxHeight:150})}function ClearAgentSearch(){var n=new objSearch;n.MemberID="";n.MainShopID="";n.AgentName="";n.SearchList="";n.DataUnit="1";n.UpdSearchConditionData(function(){window.location.href="/region/"+encodeURIComponent("台北市")+"/?cid="+encodeURIComponent("0000")})}function GoSearchOTLimSex(){($("input[id=chkOTLimSex]:checked").length==0||$("input[id=chkOTLimSex]:checked").length>0&&$("#OTLimSex").val()!="")&&GoSearch(!0,"",!0,2)}function ViewContent(n,t){var r={mode:n,rentid:t},i=new ETLib.Comm.GatewayJsonClient("/ashx/search/ViewContent.ashx");i.Method="INQUIRE";i.JsonData.RequestJsonInput=r;i.Submit(function(){var u=i.JsonData.ResponseJsonOutput,f,r;u.Status=="1"?(f=JSON.parse(u.Data),SetBtnViewed(n,"AddViewContentRentID_"+t),r="",$.each(f.View,function(n,t){r+='<article class="list'+(n%3==2?" listBlank":"")+'">';r+='\t<div class="Section">';r+='\t\t<a href="/rent/house/'+t.RentID+'/" target="_blank"><h3 class="title" title="'+t.CaseName+'">'+t.CaseName+"<\/h3><\/a>";r+='\t\t<address class="addr" title="'+t.Address+'">'+t.Address+"<\/address>";r+='\t\t<span class="price"><span class="num">'+t.PriceRental+"<\/span>元<\/span>";r+="\t<\/div>";r+='\t<span class="photoWrap">';r+='\t\t<span class="photo middleSet"><a href="/rent/house/'+t.RentID+'/" target="_blank"><img src="'+t.PicCover+'" alt="'+t.CaseName+'" onerror="PicFilter(this,5);"><\/a><\/span>';r+='\t\t<span class="photoNum"><span>'+t.PicCnt+" 張照片<\/span><\/span>";r+="\t<\/span>";r+='\t<a href="javascript:;" class="dataClose" data-id="'+t.RentID+'" name="NowViewContent">close<\/a>';r+="<\/article>"}),r!=""?($("#ViewContent").show(),$("#ViewContentList").html(r),n=="get"&&$("#ViewContentList a[name=NowViewContent]").each(function(){var n="AddViewContentRentID_"+$(this).data("id").toString();SetBtnViewed("add",n)})):($("#ViewContent").hide(),$("#ViewContentList").html("")),ViewContentClickFunction()):u.Status=="-1"},function(){})}function alertMsg(n){_appendBoxObject="";_appendBoxObject+='<div class="cont-Wrap cont-text-mag">';_appendBoxObject+='\t<p class="wording">'+n+"<\/p>";_appendBoxObject+="<\/div>";_appendBoxObject+='<div class="btn-Wrap">';_appendBoxObject+='\t<button type="button" class="btn close-btn">確定<\/button>';_appendBoxObject+="<\/div>";jQuery(this).CiRoBox({iframe:!1,BoxWidth:300,BoxHeight:114,GoFunctionStart:[CiRoBoxAutoHeight]})}$(document).ready(function(){var n,t;ChangeMode("ShowModePics",!1);n="";$("#hidLandlordNo")&&(n=$("#hidLandlordNo").val());n==""?NowSearchCondition(2):($("#btnFavorite").hide(),t=new objSearch,t.LandlordNo=n,nowsearchdata=t,GoSearch(!1,"",!0,""));$("#hidjsMatch").val()!=""&&fnMatchMail();$("#hidjsPairFav").val()!=""&&fnPairFavorite();$("#btnMatchMail").click(function(){fnMatchMail()});$("#btnFavorite").click(function(){fnPairFavorite()})});$(function(){$(document).on("click","#ViewContentList a.dataClose",function(){var n=$(this).data("id").toString();ViewContent("del",n)});$(document).on("click","#SearchContentDiv span[id^=AddViewContentRentID]",function(){var n=this.id.replace("AddViewContentRentID_","");if($(this).hasClass("btned"))ViewContent("del",n);else if($("#ViewContentList article").length>=9){alertMsg("您的稍後再看清單已滿，請刪除後再新增。");jQuery("#CiRoBox button.close-btn").off("click").on("click",function(){CiRoBoxClose();jQuery("html , body").stop().animate({scrollTop:jQuery("#ViewContent").position().top+"px"},500)})}else ViewContent("add",n)})})